!function(t,i){"function"==typeof define&&define.amd?define("MNSTR",[],function(){return t.MNSTR=i()}):"object"==typeof module&&module.exports?module.exports=i():t.MNSTR=i()}(this,function(){function t(t){return this.context=this,this.parentNode=void 0,this.getData=void 0,this.getElementChildren=void 0,this.getCellRenderer=void 0,this.renderOnInitialize=!0,this.initialScrollToElement=void 0,this.observeCellBounds=!1,this.rememberChildrenExpands=!0,this.thresholdRatio=.5,this.preventWheelBubbling=!1,this.useTransform=!0,this.className="mnstr",this.didRenderFirstElement=void 0,this.didRenderLastElement=void 0,this.t=void 0,this.i=void 0,this.s=void 0,this.h={},this.o=0,this.l=Number.MAX_VALUE,this.u=1,this.v=0,this._=void 0,this.m={},this.p=[],this.g=[],this.initialize(t)}return t.prototype={render:function(t){return this.C(t)},addEventListener:function(t,i){return this.I(t,i)},removeEventListener:function(t,i){return this.L(t,i)},getNode:function(){return this.i},dataUpdated:function(){return this.R()},reRenderAllCells:function(){return this.S(!0,!0)},cellBoundsUpdated:function(){return this.F()},toggleExpandElement:function(t){return this.T(t)},expandElement:function(t){return this.M(t)},collapseElement:function(t){return this.k(t)},isElementExpanded:function(t){return this.N(t)},getRenderedCellRendererForElement:function(t){for(var i=this.H(),s=0;s<i.length;s++){var e=i[s];if(e.A===t){var n=e.B.children[0];return n||e.B.innerHTML}}},scrollToTop:function(){var t=this.O(0);this.P(t.element)},scrollToBottom:function(){var t=this.O(this.v);this.P(t.element)},scrollToElement:function(t){this.P(t)},reset:function(){this.j()},initialize:function(t){for(var i in t)"_"!==i.charAt(0)&&t.hasOwnProperty(i)&&this.hasOwnProperty(i)&&(this[i]=t[i]);return this.renderOnInitialize&&this.C(),this},j:function(){for(this.t=void 0,this.o=0,this.l=Number.MAX_VALUE,this.u=1,this.v=0,this._=void 0,this.m={},this.p=[],this.g=[];this.s.firstChild;)this.s.removeChild(this.s.firstChild);this.U(),this.W(0),this.q()},destroy:function(){},C:function(t){return this.U(),this.D(t),this.Y(),this.G(),this.J(function(){this.K(),this.V()}.bind(this),"render"),this},D:function(t){return this.i&&this.i.parentNode&&(this.i.parentNode.removeChild(this.i),delete this.i),this.i=document.createElement("div"),this.i.classList.add(this.className),this.i.setAttribute("style","overflow-y: auto; -webkit-overflow-scrolling: touch; overflow-scrolling: touch; position: relative;"),this.parentNode=t||this.parentNode||document.body,this.parentNode.appendChild(this.i),this.i},Y:function(){return this.s=document.createElement("ul"),this.s.classList.add(this.className+"-list"),this.s.setAttribute("style","position: relative; overflow: hidden; list-style-type: none; margin: 0; padding: 0;"),this.i.appendChild(this.s),this.s},X:function(t,i){var s=document.createElement("iframe");return s.setAttribute("style","position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; border: none; opacity: 0; pointer-events: none; touch-action: none; z-index: -1000;"),s.onload=function(t){t.target.contentWindow.onresize=i.bind(this)}.bind(this),t.appendChild(s),s},V:function(){this.i.Z=this.X(this.i,this.$)},tt:function(t){var i=document.createElement("li");i.classList.add(this.className+"-cell"),i.setAttribute("style","position: absolute; width: 100%; top: 0; left: 0;"),this.observeCellBounds&&(i.Z=this.X(i,this.it));var s=document.createElement("div");return s.classList.add(this.className+"-content"),s.setAttribute("style","width: 100%; margin: 0; border: 0;"),i.appendChild(s),i.B=s,this.s.appendChild(i),i},st:function(t){return parseFloat(window.getComputedStyle(t).height)},et:function(t){return this.i.nt=t||this.i.offsetHeight,this.i.nt},ht:function(){return this.i.nt||this.et()},rt:function(t){return t.ot},lt:function(){return this.ut()-this.ft()},at:function(t,i){t.ot=i?this.st(t):t.clientHeight},dt:function(t){return t.ct||0},vt:function(t,i){i=Math.max(i,0),this.useTransform?t.style.transform="translateY("+i+"px)":t.style.top=i+"px",t.ct=i},_t:function(t){return t.ct+t.ot},ft:function(){return this.p&&this.p.length>0?this.dt(this.p[0]):0},ut:function(){return this.p&&this.p.length>0?this._t(this.p[this.p.length-1]):0},pt:function(){return this.s.children},gt:function(){this.p=this.Et(this.pt())},Et:function(t,i){t=t||this.pt();var s=[].slice.call(t);return s.sort(function(t,s){return i?s.Ct-t.Ct:t.Ct-s.Ct}),s},H:function(){return this.p},xt:function(){return this.p&&this.p.length>0?this.p[0].Ct:-1},bt:function(){return this.p&&this.p.length>0?this.p[this.p.length-1].Ct:-1},It:function(){return this.i.scrollTop},W:function(t){this.i.scrollTop=t},yt:function(t){this.i.scrollTop+=t},Lt:function(){return this.s.ot?this.s.ot:this.Rt(this.st(this.s))},wt:function(){var t=this.i.clientHeight;return t+t*(2*this.thresholdRatio)},Rt:function(t){return t=Math.max(t,0),this.s.style.height=t+"px",this.s.ot=t,t},St:function(){var t=this.ut(),i=this.Lt();if(this.bt()===this.v)t-i!=0&&this.Rt(t);else{var s=this.u*(this.v+1),e=Math.max(t,s);e!==i&&this.Rt(e)}},Ft:function(){return-this.i.clientHeight*this.thresholdRatio},Tt:function(){return this.i.clientHeight*this.thresholdRatio+this.i.clientHeight},U:function(){this.t=this.getData?this.getData.call(this.context,this):[],this.Mt(),this.kt()},R:function(){return this.U(),this.J(function(){this.K();this.It();var t=this.Nt();this.zt();var i=t?this.dt(t):void 0;if(this.zt(!0),void 0!==i){var s=this.dt(t);this.yt(s-i)}},"dataupdate"),this},O:function(t){if(!this.Ht())return this.At(this.t[t],0);for(var i=0,s=this.g.length-1;s>=0;s--){var e=this.g[s];if(e.active&&!(e.index>=t||(i+=e.elementChildren.length,e.index+i<t))){var n=t-(e.index+i-e.elementChildren.length)-1;return this.At(e.elementChildren[n],e.level)}}return this.At(this.t[t-i],0)},At:function(t,i){return{element:t,level:i}},Mt:function(){for(var t=this.t.length-1,i=0,s=0;s<this.g.length;s++){var e=this.g[s];e.active&&(i+=e.elementChildren.length)}this.v=t+i},Ht:function(){return void 0!==this.getElementChildren},Bt:function(t){return this.Ht()?this.getElementChildren.call(this.context,t,this):void 0},Ot:function(t){for(var i=this.t.indexOf(t),s=i>-1?this.t:void 0,e=void 0,n=0,h=0,r=0;r<this.g.length;r++){var o=this.g[r];if(s===this.t&&!o.elementParent&&o.index>=i)break;if(!s){var l=o.elementChildren.indexOf(t);if(l>-1){i=l,s=o.elementChildren,e=o,n=o.index+1,h=0;continue}}if(e&&o.level>e.level){var u=n+i;if(u<=o.index)return u;h+=o.elementChildren.length}else{if(e)return n+i+h;h+=o.elementChildren.length}}return i>-1?i+h+n:i},G:function(){this.i.addEventListener("scroll",this.Pt.bind(this)),this.preventWheelBubbling&&this.i.addEventListener("wheel",this.jt.bind(this))},I:function(t,i){return"object"!=typeof this.h[t]&&(this.h[t]=[]),this.h[t].push(i),this},L:function(t,i){var s;"object"==typeof this.h[t]&&(s=indexOf(this.h[t],i))>-1&&this.h[t].splice(s,1)},Ut:function(t){var i,s,e,n=[].slice.call(arguments,1);if("object"==typeof this.h[t])for(e=(s=this.h[t].slice()).length,i=0;i<e;i++)s[i].apply(this,n);this[t]&&this[t].apply(this.context,n)},Wt:function(t,i){0===i&&this.Ut("didRenderFirstElement",t,this),i===this.v&&this.Ut("didRenderLastElement",t,this)},jt:function(t){this.qt(t)},qt:function(t){var i=t.deltaY,s=i<0&&0===this.i.scrollTop,e=i>0&&this.i.scrollTop>=this.Lt()-this.ht();(s||e)&&(t.preventDefault(),this.Dt||(this.Dt=!0,s&&(this.W(1),this.W(0))))},Pt:function(t){this.J(this.Yt,"onscroll",t)},Yt:function(t){this.o=this.i.scrollTop,this.i.scrollTop>this.o?this.Dt=!1:this.i.scrollTop<this.o&&(this.Dt=!1),this.zt()},P:function(t){var i=this.Gt(t);if(i)return this.W(this.dt(i)),void delete this._;var s=this.Ot(t);if(!(s<0)){var e=s*this.u;this._=t,0!==this.p.length&&this.W(e)}},Jt:function(){this._&&this.scrollToElement(this._)},J:function(t,i){if(!this.m[i]){this.m[i]=!0;var s=[].slice.call(arguments,2);window.requestAnimationFrame(function(){t.apply(this,s),delete this.m[i]}.bind(this))}},q:function(){this.J(this.K,"cellcount")},K:function(){this.Kt(),this.Qt(),this.initialScrollToElement&&(this.Nt(!0),this.P(this.initialScrollToElement),this.initialScrollToElement=void 0)},Kt:function(){for(;0===this.H().length||this.l*(this.pt().length-2)<this.wt();){var t=this.xt(),i=this.bt(),s=i<this.v;if(!(i<this.v||t>0))break;var e=s?++i:--t;if((e=this.initialScrollToElement&&0===this.H().length?this.Ot(this.initialScrollToElement):e)<0||e>this.v)break;var n=this.tt();this.Vt(n,e),this.at(n);var h=s?this.ut():this.ft()-this.rt(n);this.vt(n,h),this.Xt(),this.gt(),this.St()}},Qt:function(){for(var t=this.H(),i=this.wt(),s=t.length-1;s>=0;s--){var e=t[s];(e.Ct<0||e.Ct>this.v||s===t.length-1&&this.l*(t.length-2)-this.rt(e)>i)&&(this.s.removeChild(e),t.splice(s,1),this.Xt(),this.St())}this.gt()},Nt:function(t){if(0!==this.p.length){this.St();for(var i,s=0,e=this.ft(),n=this.It(),h=void 0,r=0;r<this.p.length;r++){var o=this.p[r];if(t){var l=o.Ct*this.u;e=this.dt(o)-l,h=o;break}var u=this.Ot(o.A);if(-1!==u){if(u===o.Ct)return;if(s=o.Ct-u,Math.abs(s)>0){e=s*this.u,h=o;break}}}for(r=0;r<this.p.length;r++){o=this.p[r];var f=t&&void 0!==i?i:this.dt(o)-e;o.Ct-=s,this.vt(o,f),i=f+this.rt(o)}return this.St(),this.W(n-e),h}},Xt:function(){var t=this.pt(),i=0;this.l=Number.MAX_VALUE;for(var s=0;s<t.length;s++){var e=this.rt(t[s]);i+=e,this.l=Math.min(this.l,e)}this.u=i/t.length},Vt:function(t,i,s){var e=this.O(i);if(t.Zt=!0,e){var n=e.element,h=e.level;if(n&&(n!==t.A||s)){var r=this.Ht()?this.$t(n):void 0,o=this.getCellRenderer?this.getCellRenderer.call(this.context,n,i,void 0!==r,this):"";return this.ti(t),"string"==typeof o||o instanceof String?t.B.innerHTML=o:(t.B.innerHTML="",t.B.appendChild(o)),this.observeCellBounds&&window.requestAnimationFrame(function(){this.ii(t)}.bind(this)),r?(t.classList.add("expanded"),t.si=r):(t.classList.remove("expanded"),delete t.si),t.dataset.level=h,t.A=n,t.Ct=i,t.ei=h,this.Wt(n,i),t}}},S:function(t,i){this.J(this.zt,"updatecells",t,i)},zt:function(t,i){var s=this.It(),e=this.Ft(),n=this.Tt(),h=this.ft(),r=this.ut(),o=this.xt(),l=this.bt(),u=this.H(),f=!1,a=-1,d=0,c=void 0,v=!1,_=h>s+e,m=h>s+n,p=r<s+e,g=r<s+n;if(t)d=1,c=h;else{if(!_&&!g)return;if(m||p){var E=Math.round(Math.max(s+e,0)/this.u);d=1,c=(a=Math.min(E,this.v-u.length+1))*this.u,f=!0}else if(g&&l<this.v)a=l+(d=1),c=r;else{if(!(_&&o>0))return;a=o+(d=-1),c=h}}for(var C=0;C<u.length;C++){var x=u[d>0?C:u.length-1-C],b=t?x.Ct:a,I=b>=0&&b<=this.v?this.Vt(x,b,i):void 0;if(t||I){if(this.at(x),0===b&&(c=0),d>0)this.vt(x,c),c+=b>-1?this.rt(x):0;else if(d<0){var y=0;if(((c-=b>-1?this.rt(x):0)<0||0===b&&c>0)&&(y=c,c=0),this.vt(x,c),y)return this.gt(),this.zt(!0),void this.W(s-y)}v=v||this.rt(x)>0&&this.rt(x)<this.l,0}if(I&&!t&&(a+=d,0),!t&&!f&&(d>0&&c>s+n||d<0&&c<s+e))break}this.gt(),this.St(),(v||t)&&(this.Xt(),this.K()),this.Jt()},Gt:function(t){for(var i=0;i<this.p.length;i++){var s=this.p[i];if(s.A===t)return s}},F:function(){this.J(function(){this.zt(!0)}.bind(this),"cellbounds")},T:function(t){var i=this.Gt(t);i&&this.ni(i)},M:function(t){var i=this.Gt(t);i&&this.hi(i)},k:function(t){var i=this.Gt(t);i&&this.ri(i)},N:function(t){var i=this.Gt(t);return!!i&&void 0!==i.si},ni:function(t){t.si?this.ri(t):this.hi(t)},ri:function(t){t.classList.remove("expanded"),this.oi(t),this.J(function(){this.zt(!0),this.Kt()},"collapse")},hi:function(t){t.classList.add("expanded"),this.li(t),this.J(function(){this.zt(!0)},"expand")},$t:function(t){for(var i=0;i<this.g.length;i++){var s=this.g[i];if(s.element===t)return s}},ui:function(t,i){var s=this.fi(t);return{active:!0,element:t,elementIndex:s?this.Bt(s).indexOf(t):this.t.indexOf(t),elementChildren:this.Bt(t),elementParent:s,index:void 0,level:i,totalLength:0}},fi:function(t){for(var i=0;i<this.g.length;i++){var s=this.g[i];if(s.elementChildren.indexOf(t)>-1)return s.element}},li:function(t){var i=this.ui(t.A,t.ei+1);if(this.g.push(i),t.si=i,this.ai(),this.rememberChildrenExpands)for(var s=this.g.indexOf(i)+1;s<this.g.length;s++){var e=this.g[s];if(e.level<=i.level)break;e.active=!0}this.di()},oi:function(t){for(var i=t.si,s=[i],e=this.g.indexOf(i)+1;e<this.g.length;e++){var n=this.g[e];if(n.level<=i.level)break;s.push(n)}delete t.si;for(e=0;e<s.length;e++){var h=s[e];h===i?this.ci(this.g,h):this.rememberChildrenExpands?h.active=!1:this.ci(this.g,h)}this.di()},kt:function(){this.ai();for(var t=[],i=0;i<this.g.length;i++){for(var s=this.g[i],e=s.elementParent?this.Bt(s.elementParent):this.t,n=!1,h=0;h<t.length;h++){t[h].element===s.elementParent&&(n=!0)}n||-1===e.indexOf(s.element)?(s.elementChildren=[],t.push(s)):s.elementChildren=this.Bt(s.element)}for(i=0;i<t.length;i++)this.ci(this.g,t[i]);this.di()},ai:function(){for(var t=[],i=0;i<this.g.length;i++){var s=this.g[i];if(s.elementParent){for(var e=!1,n=!1,h=void 0,r=0;r<t.length;r++){var o=t[r];if(e&&o.elementParent===h.elementParent&&o.elementIndex>s.elementIndex||e&&o.elementParent===s.elementParent&&o.elementIndex>s.elementIndex||e&&o.level<s.level||o.elementParent===s.element){t.splice(r,0,s),n=!0;break}o.element===s.elementParent&&(e=!0),h=o}n||t.push(s)}else{for(n=!1,r=0;r<t.length;r++){if(!(o=t[r]).elementParent&&o.elementIndex>s.elementIndex||o.elementParent===s.element){t.splice(r,0,s),n=!0;break}}n||t.push(s)}}this.g=t},di:function(){for(var t=[],i=void 0,s=0,e=0;e<this.g.length;e++){var n=this.g[e];if(n.active){i&&(n.level>i.level?t.push(i):n.level<i.level&&(t=t.slice(0,t.length-(i.level-n.level)))),n.totalLength=n.elementChildren.length;for(var h=0;h<t.length;h++)t[h].totalLength+=n.totalLength;var r=t.length>0?t[t.length-1]:void 0,o=r?r.index:void 0,l=r?r.totalLength-n.totalLength:0,u=r?r.elementChildren.length:0,f=t&&t.length>0?t[t.length-1].elementChildren.indexOf(n.element):this.t.indexOf(n.element),a=l-u+f+(void 0!==o?o+1:0)+(1===n.level?s:0);n.elementIndex=f,n.index=a,i=n,s+=n.elementChildren.length}}this.Mt()},$:function(t){this.vi(),this.J(this._i,"resizelist")},_i:function(){this.zt(!0),this.zt(),this.et(),this.mi()},it:function(t){this.F()},ti:function(t){t.Z&&t.Z.contentWindow&&t.Z.contentWindow.onresize&&(t.Z.contentWindow.pi=t.Z.contentWindow.onresize,t.Z.contentWindow.onresize=void 0)},ii:function(t){this.observeCellBounds&&t.Z&&t.Z.contentWindow&&t.Z.contentWindow.pi&&(t.Z.contentWindow.onresize=t.Z.contentWindow.pi,t.Z.contentWindow.pi=void 0)},vi:function(){if(this.observeCellBounds)for(var t=0;t<this.p.length;t++)this.ti(this.p[t])},mi:function(){if(this.observeCellBounds)for(var t=0;t<this.p.length;t++)this.ii(this.p[t])},ci:function(t,i){return t.splice(t.indexOf(i),1)}},t});