!function(t,i){"function"==typeof define&&define.amd?define("MNSTR",[],function(){return t.MNSTR=i()}):"object"==typeof module&&module.exports?module.exports=i():t.MNSTR=i()}(this,function(){function t(t){return this.context=this,this.parentNode=void 0,this.getData=void 0,this.getElementChildren=void 0,this.getCellRenderer=void 0,this.renderOnInitialize=!0,this.initialScrollToElement=void 0,this.observeCellBounds=!1,this.rememberChildrenExpands=!0,this.thresholdRatio=.5,this.preventWheelBubbling=!1,this.useTransform=!0,this.className="mnstr",this.didRenderFirstElement=void 0,this.didRenderLastElement=void 0,this.t=void 0,this.i=void 0,this.s=void 0,this.h={},this.o=0,this.u=Number.MAX_VALUE,this.l=1,this.v=0,this._=void 0,this.m={},this.p=[],this.g=[],this.initialize(t)}return t.prototype={render:function(t){return this.C(t)},addEventListener:function(t,i){return this.I(t,i)},removeEventListener:function(t,i){return this.L(t,i)},getNode:function(){return this.i},dataUpdated:function(){return this.R()},reRenderAllCells:function(){return this.S(!0,!0)},cellBoundsUpdated:function(){return this.F()},toggleExpandElement:function(t){return this.T(t)},expandElement:function(t){return this.M(t)},collapseElement:function(t){return this.k(t)},isElementExpanded:function(t){return this.H(t)},getRenderedCellRendererForElement:function(t){for(var i=this.A(),s=0;s<i.length;s++){var e=i[s];if(e.B===t){var h=e.N.children[0];return h||e.N.innerHTML}}},scrollToTop:function(){var t=this.O(0);this.P(t.element)},scrollToBottom:function(){var t=this.O(this.v);this.P(t.element)},scrollToElement:function(t){this.P(t)},reset:function(){this.j()},initialize:function(t){for(var i in t)"_"!==i.charAt(0)&&t.hasOwnProperty(i)&&this.hasOwnProperty(i)&&(this[i]=t[i]);return this.renderOnInitialize&&this.C(),this},j:function(){for(this.t=void 0,this.o=0,this.u=Number.MAX_VALUE,this.l=1,this.v=0,this._=void 0,this.m={},this.p=[],this.g=[];this.s.firstChild;)this.s.removeChild(this.s.firstChild);this.U(),this.W(0),this.q()},destroy:function(){},C:function(t){return this.U(),this.D(t),this.Y(),this.G(),this.J(function(){this.K(),this.V()}.bind(this),"render"),this},D:function(t){return this.i&&this.i.parentNode&&(this.i.parentNode.removeChild(this.i),delete this.i),this.i=document.createElement("div"),this.i.classList.add(this.className),this.i.setAttribute("style","overflow-y: auto; -webkit-overflow-scrolling: touch; overflow-scrolling: touch; position: relative;"),this.parentNode=t||this.parentNode||document.body,this.parentNode.appendChild(this.i),this.i},Y:function(){return this.s=document.createElement("ul"),this.s.classList.add(this.className+"-list"),this.s.setAttribute("style","position: relative; overflow: hidden; list-style-type: none; margin: 0; padding: 0;"),this.i.appendChild(this.s),this.s},X:function(t,i){var s=document.createElement("iframe");return s.setAttribute("style","position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; border: none; opacity: 0; pointer-events: none; touch-action: none; z-index: -1000;"),s.onload=function(t){t.target.contentWindow.onresize=i.bind(this)}.bind(this),t.appendChild(s),s},V:function(){this.i.Z=this.X(this.i,this.$)},tt:function(t){var i=document.createElement("li");i.classList.add(this.className+"-cell"),i.setAttribute("style","position: absolute; width: 100%; top: 0; left: 0;"),this.observeCellBounds&&(i.Z=this.X(i,this.it));var s=document.createElement("div");return s.classList.add(this.className+"-content"),s.setAttribute("style","width: 100%; margin: 0; border: 0;"),i.appendChild(s),i.N=s,this.s.appendChild(i),i},st:function(t){return parseFloat(window.getComputedStyle(t).height)},et:function(t){return this.i.ht=t||this.i.offsetHeight,this.i.ht},nt:function(){return this.i.ht||this.et()},rt:function(t){return t.ot},ut:function(){return this.lt()-this.ft()},at:function(t,i){t.ot=i?this.st(t):t.clientHeight},dt:function(t){return t.ct||0},vt:function(t,i){i=Math.max(i,0),this.useTransform?t.style.transform="translateY("+i+"px)":t.style.top=i+"px",t.ct=i},_t:function(t){return t.ct+t.ot},ft:function(){return this.p&&this.p.length>0?this.dt(this.p[0]):0},lt:function(){return this.p&&this.p.length>0?this._t(this.p[this.p.length-1]):0},pt:function(){return this.s.children},gt:function(){this.p=this.Et(this.pt())},Et:function(t,i){t=t||this.pt();var s=[].slice.call(t);return s.sort(function(t,s){return i?s.Ct-t.Ct:t.Ct-s.Ct}),s},A:function(){return this.p},xt:function(){return this.p&&this.p.length>0?this.p[0].Ct:-1},bt:function(){return this.p&&this.p.length>0?this.p[this.p.length-1].Ct:-1},yt:function(){return this.i.scrollTop},W:function(t){this.i.scrollTop=t},It:function(t){this.i.scrollTop+=t},Lt:function(){return this.s.ot?this.s.ot:this.Rt(this.st(this.s))},wt:function(){var t=this.i.clientHeight;return t+t*(2*this.thresholdRatio)},Rt:function(t){return t=Math.max(t,0),this.s.style.height=t+"px",this.s.ot=t,t},St:function(){var t=this.lt(),i=this.Lt();if(this.bt()===this.v)t-i!=0&&this.Rt(t);else{var s=this.l*(this.v+1),e=Math.max(t,s);e!==i&&this.Rt(e)}},Ft:function(){return-this.i.clientHeight*this.thresholdRatio},Tt:function(){return this.i.clientHeight*this.thresholdRatio+this.i.clientHeight},U:function(){this.t=this.getData?this.getData.call(this.context,this):[],this.Mt(),this.kt()},R:function(){return this.U(),this.J(function(){this.K();this.yt();var t=this.zt();this.Ht();var i=t?this.dt(t):void 0;if(this.Ht(!0),void 0!==i){var s=this.dt(t);this.It(s-i)}},"dataupdate"),this},O:function(t){if(!this.At())return this.Bt(this.t[t],0);for(var i=0,s=this.g.length-1;s>=0;s--){var e=this.g[s];if(e.active&&!(e.index>=t||(i+=e.elementChildren.length,e.index+i<t))){var h=t-(e.index+i-e.elementChildren.length)-1;return this.Bt(e.elementChildren[h],e.level)}}return this.Bt(this.t[t-i],0)},Bt:function(t,i){return{element:t,level:i}},Mt:function(){for(var t=this.t.length-1,i=0,s=0;s<this.g.length;s++){var e=this.g[s];e.active&&(i+=e.elementChildren.length)}this.v=t+i},At:function(){return void 0!==this.getElementChildren},Nt:function(t){return this.At()?this.getElementChildren.call(this.context,t,this):void 0},Ot:function(t){for(var i=this.t.indexOf(t),s=i>-1?this.t:void 0,e=void 0,h=0,n=0,r=0;r<this.g.length;r++){var o=this.g[r];if(s===this.t&&!o.elementParent&&o.index>=i)break;if(!s){var u=o.elementChildren.indexOf(t);if(u>-1){i=u,s=o.elementChildren,e=o,h=o.index+1,n=0;continue}}if(e&&o.level>e.level){var l=h+i;if(l<=o.index)return l;n+=o.elementChildren.length}else{if(e)return h+i+n;n+=o.elementChildren.length}}return i>-1?i+n+h:i},G:function(){this.i.addEventListener("scroll",this.Pt.bind(this)),this.preventWheelBubbling&&this.i.addEventListener("wheel",this.jt.bind(this))},I:function(t,i){return"object"!=typeof this.h[t]&&(this.h[t]=[]),this.h[t].push(i),this},L:function(t,i){var s;"object"==typeof this.h[t]&&(s=indexOf(this.h[t],i))>-1&&this.h[t].splice(s,1)},Ut:function(t){var i,s,e,h=[].slice.call(arguments,1);if("object"==typeof this.h[t])for(e=(s=this.h[t].slice()).length,i=0;i<e;i++)s[i].apply(this,h);this[t]&&this[t].apply(this.context,h)},Wt:function(t,i){0===i&&this.Ut("didRenderFirstElement",t,this),i===this.v&&this.Ut("didRenderLastElement",t,this)},jt:function(t){this.qt(t)},qt:function(t){var i=t.deltaY,s=i<0&&0===this.i.scrollTop,e=i>0&&this.i.scrollTop>=this.Lt()-this.nt();(s||e)&&(t.preventDefault(),this.Dt||(this.Dt=!0,s&&(this.W(1),this.W(0))))},Pt:function(t){this.J(this.Yt,"onscroll",t)},Yt:function(t){this.o=this.i.scrollTop,this.i.scrollTop>this.o?this.Dt=!1:this.i.scrollTop<this.o&&(this.Dt=!1),this.Ht()},P:function(t){var i=this.Gt(t);if(i)return this.W(this.dt(i)),void delete this._;var s=this.Ot(t);if(!(s<0)){var e=s*this.l;this._=t,0!==this.p.length&&this.W(e)}},Jt:function(){this._&&this.scrollToElement(this._)},J:function(t,i){if(!this.m[i]){this.m[i]=!0;var s=[].slice.call(arguments,2);window.requestAnimationFrame(function(){t.apply(this,s),delete this.m[i]}.bind(this))}},q:function(){this.J(this.K,"cellcount")},K:function(){for(var t=this.A(),i=this.wt(),s=t.length-1;s>=0;s--){((o=t[s]).Ct<0||o.Ct>this.v||s===t.length-1&&this.u*(t.length-2)-this.rt(o)>i)&&(this.s.removeChild(o),t.splice(s,1),this.Kt(),this.St())}for(this.gt();0===this.A().length||this.u*(this.pt().length-2)<this.wt();){var e=this.xt(),h=this.bt(),n=h<this.v;if(!(h<this.v||e>0))break;var r=n?++h:--e;if((r=this.initialScrollToElement&&0===this.A().length?this.Ot(this.initialScrollToElement):r)<0||r>this.v)break;var o=this.tt();this.Qt(o,r),this.at(o);var u=n?this.lt():this.ft()-this.rt(o);this.vt(o,u),this.Kt(),this.gt(),this.St()}this.initialScrollToElement&&(this.zt(!0),this.P(this.initialScrollToElement),this.initialScrollToElement=void 0)},zt:function(t){if(0!==this.p.length){this.St();for(var i,s=0,e=this.ft(),h=this.yt(),n=void 0,r=0;r<this.p.length;r++){var o=this.p[r];if(t){var u=o.Ct*this.l;e=this.dt(o)-u,n=o;break}var l=this.Ot(o.B);if(-1!==l){if(l===o.Ct)return;if(s=o.Ct-l,Math.abs(s)>0){e=s*this.l,n=o;break}}}for(r=0;r<this.p.length;r++){o=this.p[r];var f=t&&void 0!==i?i:this.dt(o)-e;o.Ct-=s,this.vt(o,f),i=f+this.rt(o)}return this.St(),this.W(h-e),n}},Kt:function(){var t=this.pt(),i=0;this.u=Number.MAX_VALUE;for(var s=0;s<t.length;s++){var e=this.rt(t[s]);i+=e,this.u=Math.min(this.u,e)}this.l=i/t.length},Qt:function(t,i,s){var e=this.O(i);if(t.Vt=!0,e){var h=e.element,n=e.level;if(h&&(h!==t.B||s)){var r=this.At()?this.Xt(h):void 0,o=this.getCellRenderer?this.getCellRenderer.call(this.context,h,i,void 0!==r,this):"";return this.Zt(t),"string"==typeof o||o instanceof String?t.N.innerHTML=o:(t.N.innerHTML="",t.N.appendChild(o)),this.observeCellBounds&&window.requestAnimationFrame(function(){this.$t(t)}.bind(this)),r?(t.classList.add("expanded"),t.ti=r):(t.classList.remove("expanded"),delete t.ti),t.dataset.level=n,t.B=h,t.Ct=i,t.ii=n,this.Wt(h,i),t}}},S:function(t,i){this.J(this.Ht,"updatecells",t,i)},Ht:function(t,i){var s=this.yt(),e=this.Ft(),h=this.Tt(),n=this.ft(),r=this.lt(),o=this.xt(),u=this.bt(),l=this.A(),f=!1,a=-1,d=0,c=void 0,v=!1,_=n>s+e,m=n>s+h,p=r<s+e,g=r<s+h;if(t)d=1,c=n;else{if(!_&&!g)return;if(m||p){var E=Math.round(Math.max(s+e,0)/this.l);d=1,c=(a=Math.min(E,this.v-l.length+1))*this.l,f=!0}else if(g&&u<this.v)a=u+(d=1),c=r;else{if(!(_&&o>0))return;a=o+(d=-1),c=n}}for(var C=0;C<l.length;C++){var x=l[d>0?C:l.length-1-C],b=t?x.Ct:a,y=b>=0&&b<=this.v?this.Qt(x,b,i):void 0;if(t||y){if(this.at(x),0===b&&(c=0),d>0)this.vt(x,c),c+=b>-1?this.rt(x):0;else if(d<0){var I=0;if(((c-=b>-1?this.rt(x):0)<0||0===b&&c>0)&&(I=c,c=0),this.vt(x,c),I)return this.gt(),this.Ht(!0),void this.W(s-I)}v=v||this.rt(x)>0&&this.rt(x)<this.u,0}if(y&&!t&&(a+=d,0),!t&&!f&&(d>0&&c>s+h||d<0&&c<s+e))break}this.gt(),this.St(),(v||t)&&(this.Kt(),this.K()),this.Jt()},Gt:function(t){for(var i=0;i<this.p.length;i++){var s=this.p[i];if(s.B===t)return s}},F:function(){this.J(function(){this.Ht(!0)}.bind(this),"cellbounds")},T:function(t){var i=this.Gt(t);i&&this.si(i)},M:function(t){var i=this.Gt(t);i&&this.ei(i)},k:function(t){var i=this.Gt(t);i&&this.hi(i)},H:function(t){var i=this.Gt(t);return!!i&&void 0!==i.ti},si:function(t){t.ti?this.hi(t):this.ei(t)},hi:function(t){t.classList.remove("expanded"),this.ni(t),this.S(!0)},ei:function(t){t.classList.add("expanded"),this.ri(t),this.S(!0)},Xt:function(t){for(var i=0;i<this.g.length;i++){var s=this.g[i];if(s.element===t)return s}},oi:function(t,i){var s=this.ui(t);return{active:!0,element:t,elementIndex:s?this.Nt(s).indexOf(t):this.t.indexOf(t),elementChildren:this.Nt(t),elementParent:s,index:void 0,level:i,totalLength:0}},ui:function(t){for(var i=0;i<this.g.length;i++){var s=this.g[i];if(s.elementChildren.indexOf(t)>-1)return s.element}},ri:function(t){var i=this.oi(t.B,t.ii+1);if(this.g.push(i),t.ti=i,this.li(),this.rememberChildrenExpands)for(var s=this.g.indexOf(i)+1;s<this.g.length;s++){var e=this.g[s];if(e.level<=i.level)break;e.active=!0}this.fi()},ni:function(t){for(var i=t.ti,s=[i],e=this.g.indexOf(i)+1;e<this.g.length;e++){var h=this.g[e];if(h.level<=i.level)break;s.push(h)}delete t.ti;for(e=0;e<s.length;e++){var n=s[e];n===i?this.ai(this.g,n):this.rememberChildrenExpands?n.active=!1:this.ai(this.g,n)}this.fi()},kt:function(){this.li();for(var t=[],i=0;i<this.g.length;i++){for(var s=this.g[i],e=s.elementParent?this.Nt(s.elementParent):this.t,h=!1,n=0;n<t.length;n++){t[n].element===s.elementParent&&(h=!0)}h||-1===e.indexOf(s.element)?(s.elementChildren=[],t.push(s)):s.elementChildren=this.Nt(s.element)}for(i=0;i<t.length;i++)this.ai(this.g,t[i]);this.fi()},li:function(){for(var t=[],i=0;i<this.g.length;i++){var s=this.g[i];if(s.elementParent){for(var e=!1,h=!1,n=void 0,r=0;r<t.length;r++){var o=t[r];if(e&&o.elementParent===n.elementParent&&o.elementIndex>s.elementIndex||e&&o.elementParent===s.elementParent&&o.elementIndex>s.elementIndex||e&&o.level<s.level||o.elementParent===s.element){t.splice(r,0,s),h=!0;break}o.element===s.elementParent&&(e=!0),n=o}h||t.push(s)}else{for(h=!1,r=0;r<t.length;r++){if(!(o=t[r]).elementParent&&o.elementIndex>s.elementIndex||o.elementParent===s.element){t.splice(r,0,s),h=!0;break}}h||t.push(s)}}this.g=t},fi:function(){for(var t=[],i=void 0,s=0,e=0;e<this.g.length;e++){var h=this.g[e];if(h.active){i&&(h.level>i.level?t.push(i):h.level<i.level&&(t=t.slice(0,t.length-(i.level-h.level)))),h.totalLength=h.elementChildren.length;for(var n=0;n<t.length;n++)t[n].totalLength+=h.totalLength;var r=t.length>0?t[t.length-1]:void 0,o=r?r.index:void 0,u=r?r.totalLength-h.totalLength:0,l=r?r.elementChildren.length:0,f=t&&t.length>0?t[t.length-1].elementChildren.indexOf(h.element):this.t.indexOf(h.element),a=u-l+f+(void 0!==o?o+1:0)+(1===h.level?s:0);h.elementIndex=f,h.index=a,i=h,s+=h.elementChildren.length}}this.Mt()},$:function(t){this.di(),this.J(this.ci,"resizelist")},ci:function(){this.Ht(!0),this.Ht(),this.et(),this.vi()},it:function(t){this.F()},Zt:function(t){t.Z&&t.Z.contentWindow&&t.Z.contentWindow.onresize&&(t.Z.contentWindow._i=t.Z.contentWindow.onresize,t.Z.contentWindow.onresize=void 0)},$t:function(t){this.observeCellBounds&&t.Z&&t.Z.contentWindow&&t.Z.contentWindow._i&&(t.Z.contentWindow.onresize=t.Z.contentWindow._i,t.Z.contentWindow._i=void 0)},di:function(){if(this.observeCellBounds)for(var t=0;t<this.p.length;t++)this.Zt(this.p[t])},vi:function(){if(this.observeCellBounds)for(var t=0;t<this.p.length;t++)this.$t(this.p[t])},ai:function(t,i){return t.splice(t.indexOf(i),1)}},t});